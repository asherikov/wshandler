on:
    push:
        tags:
            - '**'

env:
    APT: sudo apt install -y --no-install-recommends

jobs:
    appimage:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - run: ${APT} desktop-file-utils
            - run: make appimage ARCH=x86_64 YQ_ARCH=amd64
            - run: make appimage ARCH=aarch64 YQ_ARCH=arm64
            - run: ./build/appimage/wshandler-x86_64.AppImage --appimage-extract-and-run -r tests/update status
            - uses: softprops/action-gh-release@v1
              with:
                files: |
                    build/appimage/wshandler*.AppImage
                    wshandler
                fail_on_unmatched_files: true
